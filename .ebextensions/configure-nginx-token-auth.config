commands:
  01-get-token-auth_file:
    command: "aws --region=us-west-2 s3 cp s3://solr.ucldc/token_auth /var/app/"
  02-move-to-nginx-dir:
    command: "mv /var/app/token_auth /etc/nginx/"

files:
  "/etc/nginx/sites-enabled/elasticbeanstalk-nginx-docker-proxy.conf":
    mode: 644
    owner: root
    group: root
    content: |
      map $http_upgrade $connection_upgrade {
      	default		"upgrade";
      	""			"";
      }
      
      server {
      	listen 80;
              
        include token_auth;
      
      	location /select {
      		proxy_pass			http://docker/solr/dc-collection/select;
      		proxy_http_version	1.1;
      		proxy_set_header	Connection			$connection_upgrade;
      		proxy_set_header	Upgrade				$http_upgrade;
      		proxy_set_header	Host				$host;
      		proxy_set_header	X-Real-IP			$remote_addr;
      		proxy_set_header	X-Forwarded-For		$proxy_add_x_forwarded_for;
      
      	}

      	location / {
      		proxy_pass			http://docker/solr/dc-collection/query;
      		proxy_http_version	1.1;
      		proxy_set_header	Connection			$connection_upgrade;
      		proxy_set_header	Upgrade				$http_upgrade;
      		proxy_set_header	Host				$host;
      		proxy_set_header	X-Real-IP			$remote_addr;
      		proxy_set_header	X-Forwarded-For		$proxy_add_x_forwarded_for;
      
      	}

      }
